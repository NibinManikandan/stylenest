{% extends 'platform/common.html' %}
{% load static %}
{% block title %}Wallet{% endblock title %}
{% block css %}<link href="{% static 'home/css/about.css' %}" rel="stylesheet" />


<style>
    .wallet-container {
      margin-top: 50px;
      margin-bottom: 20px;
    }
</style>

{% endblock css %}


{% block content %}
  
  <section id="center" class="center_o pt-4 pb-4 bg-light" style="margin: 20px;">
    <div class="container-xl">
      <div class="row center_o1 text-center">
       <div class="col-md-12">
         <h1>My Wallet</h1>
       </div>
      </div>
    </div>
  </section>
  
  
<div class="container" style="margin-top: 20px;">
  <div class="container wallet-container ">
    <div class="row justify-content-center">
      <!-- Balance Section -->
      <div class="col-10 mb-5">
        <div class="balance-section d-flex justify-content-between align-items-center">
          <div >
              <p>Wallet Balance</p>
              <h1>&#8377;{{balance}}</h1>
          </div>
          <div >
              <label>Add Amount to Wallet : </label>
              {% csrf_token %}

              <div class="input-group w-75 couponcode-wrap">
                <input type="text" class="form-control me-2" id="c_amount" placeholder="Amount in INR" aria-label="amount" aria-describedby="button-addon2">
                <div class="input-group-append">
                <button class="btn btn-black btn-sm add-to-wallet-btn" type="button" id="button-addon2" style="border-radius: 10px;">Add</button>
                </div>
              </div>
              
          </div>
          <!-- Add more balance-related information or actions here -->
        </div>
      </div>
  
      <!-- History List Section -->
      
      <div class="col-lg-12 ">
          
          <center>
        <div class="history-list col-10 mb-5">
          <table class="table">
            <h4>Payment History</h4>
              <thead>
                
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Payment Details</th>
                  <th>Payment Type</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                {% for item in wallett %}
                <tr>
                  <td>{{item.date.date}}</td>
                  <td>{{item.date.time}}</td>
                  <td>{{item.transaction_details}}</td>
                  <td class= "fw-bold {% if item.transaction_type == 'Credit' %}text-success{% else %}text-danger{% endif %}">{{item.transaction_type}}</td>
                  <td>&#8377; {{item.amount}}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
        </div>
      </center>
      
      </div>
    </div>  
  </div>
</div>

  
  {% endblock content %}

  {% block scripts %}
  <!-- Your existing code here -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>
    
    $(document).ready(function () {
      $(".add-to-wallet-btn").click(function () {
        var amount = $("input[type='number']").val();

        var csrfToken = $("input[name='csrfmiddlewaretoken']").val();

        if (
          amount &&
          !isNaN(amount) &&
          parseFloat(amount) > 0 &&
          /^[0-9]+$/.test(amount) &&
          parseFloat(amount) <= 100000
        ) {
          
          $.ajax({
            type: "POST",
            url: "add_amount", 
            data: { amount: amount,
              csrfmiddlewaretoken: csrfToken, 
             },
            success: function (data) {
          
              console.log("Amount added successfully:", data);
            
              var options = {
                "key": "rzp_test_364uDI7fwiadCE", 
                "amount": data.amount, 
                "currency": "INR",
                "name": "Acme Corp",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": data.payment_id, 
                "handler": function (response){
                    window.location.reload();
                  
                },
                "prefill": {
                    "name": "Gaurav Kumar",
                    "email": "gaurav.kumar@example.com",
                    "contact": "9000090000"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
              Swal.fire({
                icon: 'error',
                title: 'Money Not Added',
                text: 'There was an issue adding money to your account. Please try again later.',
              });
            });
            rzp1.open();
            },
            error: function (xhr, status, error) {
          
              Swal.fire({
                icon: 'error',
                title: 'Money Not Added',
                text: 'There was an issue adding money to your account. Please try again later.',
              });
        
            },
          });
        } else {
          
          alert("Invalid amount entered");
        }
      });
    });
  </script>

  {% endblock scripts %}